---
title: MMNoteå¼€å‘ç¬”è®°
date: 2016-12-21 14:23:10
categories:
tags: [mmnote]
toc: true
---

## å€¼å¾—å­¦ä¹ çš„æ•™ç¨‹

- [ä½¿ç”¨ Electron æ„å»ºæ¡Œé¢åº”ç”¨ - å‰ç«¯å¤–åˆŠè¯„è®º - çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/20225295?columnSlug=FrontendMagazine)

## å€¼å¾—å­¦ä¹ çš„APP

- [brrd/Abricotine: Markdown editor with inline preview](https://github.com/brrd/Abricotine)
- [Automattic/simplenote-electron: A Simplenote React app packaged in Electron](https://github.com/Automattic/simplenote-electron)
- [AnotherNote/anote: another markdown note (inspired by evernote)](https://github.com/AnotherNote/anote)
- [amitmerchant1990/electron-markdownify: A minimal Markdown editor desktop app based on Electron](https://github.com/amitmerchant1990/electron-markdownify)

## å¼€å‘å·¥å…·

## æ‰“åŒ…å·¥å…·

- [electron/application-distribution.md at master Â· electron/electron](https://github.com/electron/electron/blob/master/docs/tutorial/application-distribution.md)
- [electron-userland/electron-builder: A complete solution to package and build a ready for distribution Electron app with â€œauto updateâ€ support out of the box](https://github.com/electron-userland/electron-builder)
- [electron-userland/electron-packager: Package and distribute your Electron app with OS-specific bundles (.app, .exe etc) via JS or CLI](https://github.com/electron-userland/electron-packager)

## å¼€å‘æ‰‹è®°

### 2016å¹´12æœˆ22æ—¥ ReactåŠ¨ç”»
è¿™ä¸¤å¤©ä»react-treebeardè¿™ä¸ªæ’ä»¶çœ‹èµ·ï¼Œäº†è§£å…¶ä¸­ä½¿ç”¨åˆ°çš„Radiumå’Œvelocity-reactã€‚å› ä¸ºè¿™ä¸ªæ’ä»¶åœ¨é™åˆ¶å®½åº¦çš„æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºæœ‰äº›é—®é¢˜ï¼Œæ‰€ä»¥è¦ä¹ˆè¿›è¡Œä¿®æ”¹ï¼Œè¦ä¹ˆå¾—è‡ªå·±å†™ä¸€ä¸ªã€‚

å…³äº**æ ‘èŠ‚ç‚¹åŠ¨ç”»**ï¼Œè¿™ä¸ªæ’ä»¶åœ¨å±•å¼€èŠ‚ç‚¹æ—¶ï¼Œä¼šæ—‹è½¬å·¦ä¾§ç®­å¤´(svgç”»çš„)ï¼ŒåŒæ—¶ä¼šåŠ¨ç”»å±•å¼€å…¶å­åˆ—è¡¨ã€‚è¿™ä¸ªè¿˜ä¸é”™ã€‚æˆ‘ä¸€ç›´ä»¥ä¸ºæ‰€æœ‰çš„ç¼–è¾‘å™¨éƒ½æœ‰è¿™ä¸ªåŠ¨ç”»çš„ï¼Œä»¥ä¸ºå¾ˆåŸºç¡€å˜›ï¼Œæ²¡æƒ³åˆ°è§‚å¯Ÿäº†ä¸€ä¸‹,æ¯ä¸ªç¼–è¾‘å™¨è¡¨ç°éƒ½ä¸ä¸€æ ·ï¼š

- sublime: ç®­å¤´æ— åŠ¨ç”»ï¼Œå±•å¼€æœ‰åŠ¨ç”»
- vscode: éƒ½æ— åŠ¨ç”»
- atom: éƒ½æ— åŠ¨ç”»
- TextMate: ç®­å¤´æ— åŠ¨ç”»ï¼Œå±•å¼€æœ‰åŠ¨ç”»

æ²¡æƒ³åˆ°ï¼Œè¿™ä¸¤ä¸ªåŠ¨ç”»ç«Ÿç„¶æ²¡æœ‰åšå…¨çš„ã€‚å…¶ä¸­ï¼Œçœ‹äº†vscodeå’Œatomçš„htmlï¼Œå…¶ç®­å¤´éƒ½æ˜¯ä½¿ç”¨::beforeä¼ªå…ƒç´ åšåˆ°çš„ï¼Œæ‰€ä»¥ä¸æ”¯æŒåŠ¨ç”»å§ã€‚(2016å¹´12æœˆ24æ—¥ è¡¥å……ï¼šçœ‹äº†ä¸‹ant designçš„æ ‘æ§ä»¶ï¼Œä½¿ç”¨ä¼ªå…ƒç´ ï¼Œä¹Ÿæ˜¯èƒ½åšåˆ°åŠ¨ç”»çš„)

å†è¯´è¯´**åœ¨æœ‰é™ç©ºé—´å†…ï¼Œå„ä¸ªç¼–è¾‘å™¨æ˜¯å¦‚ä½•å±•ç¤ºçš„æ¡ç›®**çš„ï¼š

- sublime: ä¸ä¼šå‹ç¼©æ˜¾ç¤ºï¼Œå¯ä»¥æ¨ªå‘æ»šåŠ¨
- vscode: å‹ç¼©æ˜¾ç¤ºï¼Œæ¡ç›®åç§°æœ€åå‹ç¼©ä¸ºçœç•¥å·
- atom: ä¸ä¼šå‹ç¼©æ˜¾ç¤ºï¼Œå¯ä»¥æ¨ªå‘æ»šåŠ¨
- TextMate: å‹ç¼©æ˜¾ç¤ºï¼Œæ¡ç›®åç§°ä¸­é—´å‹ç¼©ä¸ºçœç•¥å·

æˆ‘ä¸ªäººæ˜¯å€¾å‘äºä¸å‹ç¼©æ˜¾ç¤ºçš„ã€‚

### 2016å¹´12æœˆ25æ—¥ æ ‘æ§ä»¶ Webpackè‡ªåŠ¨åˆ·æ–° åŒºåˆ†é…ç½®æ–‡ä»¶
ä»Šå¤©æ—©ä¸Šç«Ÿç„¶å¤±çœ ï¼Œ6ç‚¹å¤šå°±èµ·æ¥äº†ï¼Œç»§ç»­å†™æ ‘æ§ä»¶ï¼Œç°åœ¨æœ‰ç‚¹æ ·å­äº†ï¼Œæ•´åˆäº†web fontå’Œmax-contentï¼š

![](/img/mmnote/2016-12-25.png)

ä¸»è¦æ˜¯è§£å†³äº†react-treebreadç©ºé—´çš„å°ç©ºé—´æ¢è¡Œé—®é¢˜å’Œå®½åº¦ä¸å¯¹é—®é¢˜ã€‚CSSçš„widthæ˜¯å…³é”®ï¼Œå…·ä½“å‚è€ƒäº†ï¼š[ç†è§£CSS3 max/min-contentåŠfit-contentç­‰widthå€¼](http://www.zhangxinxu.com/wordpress/2016/05/css3-width-max-contnet-min-content-fit-content/).

æˆ‘ä¸€éåšä¸€è¾¹å‚è€ƒatomå’Œvscodeï¼ˆåŸºäºHTML5æŠ€æœ¯å°±æ˜¯å¥½å•Šï¼Œéšæ—¶éšåœ°å¯ä»¥å‚è€ƒï¼‰ã€‚å‘ç°atomæ˜¯å¸¸è§„åšæ³•ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªæ ‘æ˜¯ä¸€ä¸ªolæˆ–è€…ulï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªé€’å½’æ¸²æŸ“å‡ºã€‚å¯¹äºæ²¡æœ‰æ‰“å¼€çš„å­ç›®å½•æ˜¯ä¸ä¼šæ¸²æŸ“åˆ°DOMä¸Šçš„ã€‚

ä½†æ˜¯vscodeå´ä¸æ˜¯ã€‚å…¶ç›®å½•æ ‘å®Œå…¨æ˜¯ä¸€ä¸ªdiv listã€‚å±‚çº§å…³ç³»çš„è¡¨ç¤ºéƒ½æ˜¯åœ¨inline styleä¸­è®¾ç½®padding leftåšåˆ°çš„ï¼Œåº”è¯¥æ˜¯åœ¨ä»£ç ä¸­ç®—å‡ºæ¥çš„ã€‚è€Œä¸”ï¼Œæœ€æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œä»–æ²¡æœ‰æ¸²æŸ“å‡ºæ•´ä¸ªå·²ç»æ‰“å¼€çš„ç›®å½•æ ‘ï¼Œè€Œæ˜¯åªæ¸²æŸ“äº†ä½†æ±‚å¯è§èŒƒå›´å†…çš„èŠ‚ç‚¹ï¼ï¼ï¼**è¿™æ˜¯å¤šä¹ˆæœºæ™ºçš„ä¼˜åŒ–å•Šï¼ï¼ï¼**

è¿™æ ·å°±ç®—ä½ æ‰“å¼€äº†Nå¤šæ–‡ä»¶çš„ç›®å½•ï¼Œé¡µé¢ä¹Ÿä¸ä¼šå¡é¡¿ï¼Œå› ä¸ºä»–åªæ¸²æŸ“å½“å‰å¯ä»¥æ˜¾ç¤ºçš„è¿™ä¹ˆåå‡ æ¡æ•°æ®ã€‚å­¦ä¹ äº†ã€‚

æ™šä¸Šï¼š
å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨webpackçš„å¼€å‘æœåŠ¡å™¨ï¼Œä»¥åŠå¦‚ä½•åŒºåˆ†é…ç½®ï¼š

```
"hot-server": "cross-env NODE_ENV=development node --max_old_space_size=2096 -r babel-register server.js",
```

è¿™æ˜¯electron-react-boilerplateé¡¹ç›®çš„ä¸€ä¸ªnpm scriptã€‚é€šè¿‡cross-envè¿™ä¸ªåŒ…æ¥æŒ‡å®šç¯å¢ƒå˜é‡ï¼ŒåŒºåˆ†å¼€å‘ç¯å¢ƒè¿˜æ˜¯æ­£å¼ç¯å¢ƒï¼Œç„¶ååœ¨ä»£ç ä¸­åˆ¤æ–­è¯¥å˜é‡èµ°ä¸é€šé…ç½®ç­‰ï¼š

```
if (process.env.NODE_ENV === 'production') {
  module.exports = require('./configureStore.production'); // eslint-disable-line global-require
} else {
  module.exports = require('./configureStore.development'); // eslint-disable-line global-require
}
```

çœ‹äº†ä¸‹[Redux å…¥é—¨æ•™ç¨‹ï¼ˆä¸‰ï¼‰ï¼šReact-Redux çš„ç”¨æ³• - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html)ï¼Œä¸æ˜¯å¾ˆæ‡‚ã€‚ã€‚ã€‚æ„Ÿè§‰ç»“åˆReduxè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œæ¦‚å¿µæ¯”è¾ƒå¤šã€‚

è¿™ä¸¤å¤©å¯¹æ•´ä¸ªReactåº”ç”¨å¼€å‘å’ŒCSSéƒ½åŠ æ·±äº†è®¤è¯†ï¼Œä½†æ˜¯å®Œå…¨ä¸å¤Ÿå•Šï¼Œè¿˜æ˜¯æ²¡æœ‰åˆ°è¾¾èƒ½å¤Ÿâ€œå¼€å·¥â€çš„æ ‡å‡†ã€‚ã€‚ã€‚


### 2016å¹´12æœˆ30-31æ—¥ æ–°å»ºå·¥ç¨‹
å æ—¶å…ˆä¸å­¦ä¹ Reduxäº†ï¼Œç›´æ¥å¼€å§‹å†™å§ï¼Œæ–°å»ºå·¥ç¨‹èµ°èµ·ã€‚

```
mkdir mmnote
cd mmnote
npm init

npm install --save-dev webpack typescript awesome-typescript-loader source-map-loader  css-loader style-loader webpack-dev-server less less-loader
npm install --save react react-dom @types/react @types/react-dom lodash electron normalize.css
npm install --save codemirror @types/codemirror react-split-pane @types/react-split-pane

// fs-extra @types/fs-extra
```

//TODO æ­å»ºé¡¹ç›®ç¬”è®°ï¼Œè®°å½•ç›®å‰æ­å»ºçš„æ­¥éª¤ï¼Œéšç€é¡¹ç›®ä¸æ–­æ¨è¿›ï¼Œä¸æ–­å­¦ä¹ åæ›´æ–°ã€‚

![](/img/mmnote-2016-12-31-tree-demo.png)


### 2017å¹´01æœˆ01æ—¥ æ˜ŸæœŸæ—¥ æ ‘å½¢æ§ä»¶ä¸çœŸå®ç›®å½•å¯¹åº”
ä»Šå¤©é›¾éœ¾å¥½å¤§ï¼Œå»å¥¥æ—åŒ¹å…‹å…¬å›­é€›äº†é€›ã€‚ä»Šå¤©äº‰å–å§ç›®å½•æ ‘å’ŒçœŸæ˜¯ç›®å½•å¯¹åº”ä¸Šã€‚

ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯node.jsä¸­å¦‚ä½•éå†ç›®å½•æ ‘ã€‚

fs-extraè¿™ä¸ªåŒ…æ˜¯fsåŒ…çš„æ‰©å±•ï¼Œå…¶ä¸­åŒ…æ‹¬äº†éå†ç›®å½•æ ‘ã€‚

ä½†æ˜¯å‘¢ï¼Œä¾èµ–è¿™ç§æ‰©å±•ï¼Œå¯¹åº”çš„tså£°æ˜åˆå¤ªä¹…äº†ï¼Œç°åœ¨è¿˜æ‡’å¾—å­¦ä¹ å¦‚ä½•ç¼–å†™å£°æ˜ã€‚è¿˜æ˜¯çœ‹çœ‹å¯¹åº”çš„walkæ˜¯å¦‚ä½•å®ç°çš„å§ã€‚

[node-klaw: A Node.js file system walker with a Readable stream interface](https://github.com/jprichardson/node-klaw)

ä»£ç å¾ˆç®€å•ï¼Œå°±ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æ¶‰åŠçš„çŸ¥è¯†ç‚¹å¾ˆå¤šã€‚

æˆ‘å­¦ç€ä»–çš„ä»£ç å†™äº†ä¸€ä¸ªä¾‹å­ï¼š

```
var Readable = require("stream").Readable;
var util = require("util");

function Walker() {
    var options = {
        objectMode: true
    };
    this.result = [];
    Readable.call(this, options);
}

Walker.prototype._read = function() {
    if (this.result.length == 3) {
        return this.push(null);
    }
    this.result.push("hello");
    this.push("hello");
}

util.inherits(Walker, Readable)

var walk = new Walker();
walk.on("data", function(data) {
    console.log(data);
});
walk.on("end", function(data) {
    console.log("end");
    console.log(data);
});
```

è¿™æ˜¯è‡ªå®šä¹‰Readableçš„æœ€ç®€å•çš„ä¸€ä¸ªä¾‹å­äº†ã€‚

- ä½¿ç”¨nodejsè‡ªå¸¦çš„util.inherits()æ¥å®ç°ç»§æ‰¿
- ç»§æ‰¿Readableä¸€å®šè¦å®ç°_read()æ–¹æ³•ï¼Œå…¶ä¸­ä½¿ç”¨this.push()æ¥æ·»åŠ è¿™æ¬¡è¯»å–çš„å†…å®¹ï¼Œä½¿ç”¨this.push(null)è¡¨ç¤ºè¯»å–å®Œæ¯•

è‡³äºå¦‚ä½•æ•´åˆåˆ°é¡¹ç›®ä¸­ï¼Œç›®å‰è§‰å¾—å…ˆä½¿ç”¨fs.readdir()æ¥å®ç°å³å¯ã€‚

tsçš„interfaceå¯ä»¥æœ‰é»˜è®¤å€¼ä¹ˆï¼Ÿ -- ä¸èƒ½

ä»Šæ—¥è¿›å±•ï¼š

![]ï¼ˆ/img/mmnote-2017-01-02-tree-demo.png)

### 2017å¹´01æœˆ02æ—¥ æ˜ŸæœŸä¸€ æ ‘å½¢æ§ä»¶æ»šåŠ¨æ¡æ ·å¼
çœ‹Atomçš„æ»šåŠ¨æ¡æ ·å¼å‘ç°cssçš„é€‰æ‹©å™¨ä¸­å‡ºç°äº†`/deep/`è¿™ç§å†™æ³•ã€‚

[html5 - What do /deep/ and ::shadow mean in a CSS selector? - Stack Overflow](http://stackoverflow.com/questions/25609678/what-do-deep-and-shadow-mean-in-a-css-selector/25609679#25609679)

çœ‹æ¥æ˜¯ä¸ºäº†èƒ½å¤Ÿä¿®é¥°shadow domå†…éƒ¨è€Œç”Ÿçš„é€‰æ‹©å™¨ã€‚

---

æ»šåŠ¨æ¡æ ·å¼ç›®å‰çœ‹æ¥æ²¡æœ‰åŒæ„å†™æ³•ï¼Œè¿˜å¥½æˆ‘ä»¬åªç”¨å†™webkitçš„ï¼š

[è‡ªå®šä¹‰æµè§ˆå™¨æ»šåŠ¨æ¡çš„æ ·å¼ï¼Œæ‰“é€ å±äºä½ çš„æ»šåŠ¨æ¡é£æ ¼](http://www.lyblog.net/detail/314.html)

ä¿®æ”¹äº†æ»šåŠ¨æ¡æ ·å¼çš„æ•ˆæœï¼š

![](/img/mmnote-2017-01-02-tree-demo2.png)

---

å‘ç°æ ‘æ§ä»¶ä¸­çš„é€‰ä¸­æ˜¯ä¸ªéº»çƒ¦äº‹ã€‚ç‚¹å‡»ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé€‰ä¸­å½“å‰ï¼Œä½†æ˜¯éœ€è¦æŠŠä¹‹å‰é€‰ä¸­çš„å–æ¶ˆé€‰ä¸­ï¼Œå¦‚æœæ”¯æŒå¤šé€‰ï¼Œå°±å¾—ç”¨ä¸€ä¸ªæ•°ç»„æ¥ä¿å­˜äº†ã€‚

è€Œä¸”é€‰ä¸­åçš„é«˜äº®ä¹Ÿæ˜¯éº»çƒ¦äº‹ã€‚vscodeä¸­å› ä¸ºä¸æ˜¯æ•°ç»“æ„æ‰€ä»¥å¥½åšï¼Œä½†æ˜¯Atomä¸­å°±ä¸å®¹æ˜“äº†ï¼Œéœ€è¦ç”¨ä¸€ä¸ªå®šä½ä¸ºabsoluteçš„beforeä¼ªå…ƒç´ æ¥åšåˆ°ã€‚

---

æœäº†ï¼Œjavascriptä¸­ç«Ÿç„¶æ²¡æœ‰æ¸…ç©ºæ•°ç»„çš„æ–¹æ³•ã€‚ã€‚ã€‚see [How do I empty an array in JavaScript? - Stack Overflow](http://stackoverflow.com/questions/1232040/how-do-i-empty-an-array-in-javascript)

---

æ¥ç€å°±æ˜¯å¼•å…¥code-mirroräº†ã€‚

å‚è€ƒé¡¹ç›®ï¼š[JedWatson/react-codemirror: Codemirror Component for React.js](https://github.com/JedWatson/react-codemirror)

**æ³¨æ„** CodeMirror.fromTextArea()è¿™ä¸ªæ–¹æ³•ï¼Œä¼šä½¿ç”¨textareaä¸­çš„å†…å®¹ï¼Œå¿½è§†ä¼ å…¥çš„valueå‚æ•°ã€‚

---

é‡åˆ°ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜ï¼Œcodemirrorå’Œflexå¸ƒå±€ç»“åˆï¼Œå¯¼è‡´å®½åº¦å¤„ç†ä¸å¯¹äº†ã€‚

è¢«æåäº†ï¼Œä¸€ä¸ªä¸‹åˆå°±èŠ±åœ¨codemirrorçš„linenumberä¸Šäº†ï¼Œæä¸æ‡‚æ–°å†™çš„ä¾‹å­éƒ½æ²¡é—®é¢˜ã€‚å°±æ˜¯è¿™ä¸ªé¡¹ç›®é‡Œé¢çš„æœ‰é—®é¢˜ã€‚

è¡¨ç°æ˜¯è¿™æ ·çš„ï¼š

![](../../img/mmnote-2017-01-02-codemirror-error.png)

å³è¾¹ç°è‰²çš„å…¨æ˜¯line numberã€‚ã€‚ã€‚å…ˆå›é¿è¿™ä¸ªé—®é¢˜å§ã€‚

ç›®å‰çš„æ•ˆæœï¼š

![](/img/mmnote-2017-01-02-codemirror-demo.png)

ä¹çœ‹è¿˜ä¸é”™ğŸ˜ï¼Œä½†æ˜¯è¿˜å¾ˆä¸å®Œç¾ã€‚

---

æ¥ä¸‹æ¥æ˜¯æƒ³å®ç°å¿«æ·é”®Ctrl+Sä¿å­˜çš„åŠŸèƒ½ã€‚

å­¦ä¹ [ä½¿ç”¨ Electron æ„å»ºæ¡Œé¢åº”ç”¨ - å‰ç«¯å¤–åˆŠè¯„è®º - çŸ¥ä¹ä¸“æ ](https://zhuanlan.zhihu.com/p/20225295?columnSlug=FrontendMagazine)

å…¶ä¸­æåˆ°äº†æ— æ ‡é¢˜æ çª—å£çš„åšæ³•ï¼Œå¯ä»¥åœ¨macä¸­åšå‡ºå¾ˆæ¼‚äº®çš„ç•Œé¢ï¼š

[Frameless Window - Electron](http://electron.atom.io/docs/api/frameless-window/)

è§‚å¯Ÿäº†ä¸€ä¸‹ï¼Œå‘ç°atomæ˜¯åŒ…å«ç³»ç»Ÿæ ‡é¢˜æ çš„ï¼Œè€Œvscodeåˆ™æ˜¯ä½¿ç”¨äº†`titleBarStyle: 'hidden'`åŠ ä¸Šè‡ªå®šä¹‰çš„æ ‡é¢˜æ å®ç°çš„ã€‚

![](/img/mmnote-2017-01-02-atom-title-bar.png)

![](/img/mmnote-2017-01-02-vacode-title-bar.png)

åè€…å¯ä»¥è®©æ ‡é¢˜æ æˆä¸ºä¸»é¢˜å¯ä»¥å®šåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œæ˜æ˜¾æ›´å¥½çœ‹äº†ã€‚ä¸çŸ¥é“windowsåº•ä¸‹æ˜¯å¦‚ä½•è¡¨ç°çš„ã€‚

---

ipcåŸæ¥æ˜¯é€šè¿‡onå’Œsendæ¥äº¤äº’çš„ï¼Œç”¨èµ·æ¥å¾ˆç®€å•ã€‚

è¢«å‘äº†ä¸€æ³¢ã€‚`var ipc = require('ipc');`è¿™ç§å†™æ³•æ˜¯è¿‡æ—¶çš„ï¼Œæ–°çš„å†™æ³•æ˜¯ï¼š`const {ipcMain} = require('electron')`

[ipcMain - Electron](http://electron.atom.io/docs/api/ipc-main/)

### 2017å¹´01æœˆ04æ—¥ æ˜ŸæœŸä¸‰ IPC

é‡åˆ°é”™è¯¯`Cannot find name 'Promise'`ï¼Œéœ€è¦æŠŠtypescriptçš„targetæ”¹æˆes1.6

[node.js - error TS2304: Cannot find name 'Promise' - Stack Overflow](http://stackoverflow.com/questions/39116687/error-ts2304-cannot-find-name-promise)


ã€Šelectronå­¦ä¹ ç¬”è®°ã€‹ï¼Œæ·»åŠ IPCç« èŠ‚ã€‚

### 2017å¹´01æœˆ07æ—¥ æ˜ŸæœŸå…­ å¿«æ·é”® å‘½ä»¤æ¡†æ¶

å¦‚ä½•ä¸ºç¨‹åºæ·»åŠ å¿«æ·é”®å‘¢ï¼ˆéå…¨å±€å¿«æ·é”®ï¼‰ï¼Ÿ

vscodeçš„å¿«æ·é”®è®¾ç½®æ ¼å¼æ˜¯ï¼š

```
{ "key": "cmd+delete", "command": "deleteAllRight",
                       "when": "editorTextFocus && !editorReadonly" },
```

ä¸€ä¸ªå¿«æ·é”®ç»‘å®šäº†ä¸€ä¸ªå‘½ä»¤ï¼ŒåŒæ—¶whenæŒ‡å®šäº†å¿«æ·é”®ç”Ÿæ•ˆçš„å‰ææ¡ä»¶ã€‚æ¡ä»¶ç”±å‡ ä¸ªboolå˜é‡æ„æˆã€‚

è€Œä¸€å¦‚æ—¢å¾€ï¼ŒAtomçš„è®¾è®¡æ›´ä¸ºå¹æœï¼š

```
'atom-text-editor':
  'ctrl-b': 'typescript:go-to-declaration'

'atom-text-editor[data-grammar="source gfm"]:not([mini])':
  'tab':        'markdown-folder:dwim-toggle'
  'alt-c':      'markdown-folder:cycle'
```

ç±»ä¼¼cssé€‰æ‹©å™¨çš„å†™æ³•ï¼Œæ›´åŠ å¼ºå¤§ã€‚

æˆ‘å‘ç°å¥½å‡ ä¸ªåœ°æ–¹çš„è®¾è®¡éƒ½æ˜¯å¦‚ä½•ï¼ŒAtomçš„è®¾è®¡æ›´åŠ å‰å«ã€‚å¯æƒœä»£ç è´¨é‡æ²¡æœ‰å¤§ç¥æ¥ç›‘ç£ï¼Œå¯¼è‡´åœ¨æ€§èƒ½ä¸Šè´¥äº†ã€‚åŒæ—¶é€‰å‹coffeescriptä¹Ÿæ˜¯ä¸ªç™½ç—´é€‰æ‹©ã€‚

---

ä¸Šé¢ä¸¤ä¸ªæ˜¯ç‹ç‰Œï¼Œæœ€æ±‚æœ€é«˜å¯å®šåˆ¶ã€‚è€Œæ™®é€šè½¯ä»¶æ˜¯å¦‚ä½•åšçš„å‘¢ï¼Ÿ

electronæœ¬èº«ä½¿ç”¨MenuItemä¸­çš„clickå±æ€§æ¥å®šä¹‰èœå•ç‚¹å‡»åæ‰§è¡Œçš„ä»£ç ã€‚æˆ‘çœ‹äº†Abricotineè¿™æ¬¾ç¬”è®°è½¯ä»¶çš„å®ç°ï¼Œä»–åœ¨èœå•templateä¸­æ·»åŠ äº†å‡ ä¸ªè‡ªå®šä¹‰å­—æ®µï¼Œæ¯”å¦‚platformï¼Œcommandã€‚ç„¶ååœ¨æ–°å»ºèœå•ä¹‹å‰ï¼Œå¤„ç†ä¸€étemplateï¼Œæ¯”å¦‚æ£€æŸ¥å½“å‰å¹³å°ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œå°±éšè—ä¸€äº›èœå•é¡¹ã€‚ç„¶åæŠŠæ‰€æœ‰çš„commandç¿»è¯‘ä¸ºå¯¹åº”çš„clickå‡½æ•°ï¼Œä½¿ç”¨å…¶é¡¶çº§Applicationç±»æ¥æ‰§è¡Œå‘½ä»¤ã€‚

```
// å¤„ç†templateä¸­çš„æ¯ä¸ªitem

// æŠŠcommandç¿»è¯‘ä¸ºclickå‡½æ•°ï¼Œå§”æ‰˜ç»™sendCommand
// sendCommandçš„å®šä¹‰æ˜¯ï¼švar sendCommand = abrApp.execCommand.bind(abrApp)
if (item.command) {
    item.click = (function (command, parameters) {
        return function () { sendCommand(command, parameters); };
    })(item.command, item.parameters);
    item.id = item.command;
    delete item.command;
    delete item.parameters;
}

// å¯¹äºèœå•çš„çŠ¶æ€ï¼Œè¿˜å¯ä»¥æ ¹æ®é…ç½®æ–‡ä»¶æ¥æ›´æ–°
if (item.type === "checkbox" && typeof item.checked === "string") {
    item.checked = getConfig(config, item.checked);
}
```

æˆ‘è§‰å¾—è¿™ä¸ªè®¾è®¡éå¸¸å€¼å¾—å­¦ä¹ ã€‚ç”¨å‘½ä»¤æ¥ç»„ç»‡è¿™äº›æ“ä½œï¼Œä¹Ÿæ˜¯æ‰€æœ‰ç¼–è¾‘å™¨çš„è®¾è®¡ï¼Œè¿™æ ·ç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤é¢æ¿ä¸­æ‰§è¡Œã€‚

---

Abricotineä¸­æ˜¯å¦‚ä½•execå‘½ä»¤çš„å‘¢ï¼Ÿ

```
execCommand: function (command, parameters) {
    // å‘é€å‘½ä»¤åˆ°å½“å‰æ¿€æ´»çš„çª—å£
    var win = BrowserWindow.getFocusedWindow();
    if (win) {
        // ä½¿ç”¨IPCå‘é€å‘½ä»¤
        return win.webContents.send("command", command, parameters);
    }
    // if no window, run a command from commands-main.js
    if (commands && commands[command]) {
        commands[command](this, parameters);
    } else {
        console.error("Unknown command '" + command + "'");
    }
}
```

ç­”æ¡ˆæ˜¯é€šè¿‡IPCå‘é€å‘½ä»¤å¸¦å¯¹åº”çš„windowæ¥æ‰§è¡Œã€‚åœ¨renderè¿›ç¨‹ä»£ç ä¸­ï¼Œå®šä¹‰commandåˆ—è¡¨ï¼š

```
var commands = {

    new: function(win, abrDoc, cm) {
        abrDoc.new();
    },

    open: function(win, abrDoc, cm) {
        abrDoc.open();
    },

    ...
}

// æ‰§è¡Œå‘½ä»¤
execCommand: function (command, parameters) {
    var win = remote.getCurrentWindow(),
        abrDoc = this;
    if (commands && commands[command]) {
        commands[command](win, abrDoc, abrDoc.cm, parameters);
    } else {
        console.error("Unknown command '" + command + "'");
    }
},
```

---

ã€Šelectronå­¦ä¹ ç¬”è®°ã€‹ï¼Œæ·»åŠ å¯¹è¯æ¡†ï¼Œèœå•ï¼Œå¿«æ·é”®ï¼Œshellç« èŠ‚ã€‚

---

æ–°å»ºã€ŠAbricotineæ˜¯å¦‚ä½•æ•´åˆCodeMirrorçš„ã€‹

### 2017å¹´01æœˆ08æ—¥ æ˜ŸæœŸæ—¥ CodeMirroræ’ä»¶æœºåˆ¶

æ˜¨å¤©çŸ¥é“äº†Abricotineçš„é‚£äº›â€œç‰¹æ•ˆâ€æ˜¯é€šè¿‡CodeMirroræ’ä»¶å®ç°çš„ã€‚ä»Šå¤©æ¥äº†è§£ä¸€ä¸‹å¦‚ä½•å†™CodeMirroræ’ä»¶ã€‚

ã€ŠCodeMirrorä½¿ç”¨ç¬”è®°ã€‹æ·»åŠ â€œæ‰©å±•CodeMirrorâ€ç« èŠ‚

ã€ŠAbricotineæ˜¯å¦‚ä½•æ•´åˆCodeMirrorçš„ã€‹å®Œå–„

### 2017å¹´01æœˆ14æ—¥ æ˜ŸæœŸå…­ å®Œå–„é¡¹ç›®æ­å»º

ã€Šnode.jsæ–°çš„åŒ…ç®¡ç†å™¨ - yarnã€‹å®Œæˆã€‚

ã€Šä½¿ç”¨yeomanåˆ›å»ºé¡¹ç›®ç”Ÿæˆå™¨ã€‹å®Œæˆã€‚

### 2017å¹´01æœˆ15æ—¥ æ˜ŸæœŸæ—¥ å·¥ä½œæµå‡çº§ gulp electron-connect mocha

keywordï¼š 

- å­¦ä¹ vscode debugè®¾ç½®
- å­¦ä¹ mocha/chaiï¼Œä¸typescriptç»“åˆ
- å­¦ä¹ gulpï¼Œè®¾è®¡å·¥ä½œæµæ•´åˆ
- gulpæ•´åˆwebpack+electron-connect
    - watchä¸»è¿›ç¨‹ä»£ç ï¼Œä½¿ç”¨gulp-typescriptç¼–è¯‘ä¸»è¿›ç¨‹ä»£ç ï¼Œrestart electron
    - watchæ¸²æŸ“è¿›ç¨‹ä»£ç ï¼Œä½¿ç”¨webpack-streamç¼–è¯‘æ¸²æŸ“è¿›ç¨‹ä»£ç ï¼Œreload electron
- gulpç”Ÿæˆtypescript
    - ç”Ÿæˆtsçš„sourcemapçš„é…ç½® [floridoo/gulp-sourcemaps: Source map support for Gulp.js](https://github.com/floridoo/gulp-sourcemaps#write-options)
    - å¦‚ä½•ä½¿ç”¨vscodeæ¥è°ƒè¯• [debugging - How to debug a gulp task with VSCode - Stack Overflow](http://stackoverflow.com/questions/37477139/how-to-debug-a-gulp-task-with-vscode)
- gulp testä»»åŠ¡
    - ä½¿ç”¨gulp-typescriptç¼–è¯‘renderä»£ç ï¼Œå’Œtestä»£ç åˆ°test-outä¸­
    - æ‹·è´test-resåˆ°test-outä¸­å»
    - æ‰§è¡Œæµ‹è¯•

äº†è§£åˆ°çš„åº“ï¼š
- ä½¿fsç­‰æ ‡å‡†åº“æ”¯æŒpromiseï¼š[normalize/mz: modernize node.js to current ECMAScript standards](https://github.com/normalize/mz)

å­¦ä¹ åˆ°çš„è¯­æ³•ï¼š
- tsä¸æ”¯æŒé‡è½½
- interfaceä¸æ”¯æŒé»˜è®¤å€¼

### 2017å¹´01æœˆ18æ—¥ æ˜ŸæœŸä¸‰ æ›´æ–°ä»£ç ç»“æ„ main render test

æ›´æ–°äº†ç›®å½•ç»“æ„ï¼Œä»£ç éƒ½æ”¾åœ¨srcä¸‹ï¼š

```
.
â”œâ”€â”€ src ä»£ç ç›®å½•
â”‚Â Â  â”œâ”€â”€ common å…¬ç”¨ä»£ç 
â”‚Â Â  â”œâ”€â”€ main ä¸»è¿›ç¨‹ä»£ç 
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ res èµ„æºæ–‡ä»¶
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ application.ts
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main.ts å…¥å£æ–‡ä»¶
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ menu.ts
â”‚Â Â  â”‚Â Â  â””â”€â”€ window.ts
â”‚Â Â  â””â”€â”€ render æ¸²æŸ“è¿›ç¨‹ä»£ç 
â”‚Â Â      â”œâ”€â”€ component reactç»„ä»¶
â”‚Â Â      â”œâ”€â”€ res èµ„æºæ–‡ä»¶
â”‚Â Â      â”œâ”€â”€ service
â”‚Â Â      â”œâ”€â”€ util
â”‚Â Â      â”œâ”€â”€ index.less
â”‚Â Â      â””â”€â”€ index.tsx
â”œâ”€â”€ test æµ‹è¯•ä»£ç ç›®å½•
â”‚Â Â  â”œâ”€â”€ res æµ‹è¯•èµ„æºç›®å½•
â”‚Â Â  â””â”€â”€ tree-service.spec.ts 
â”œâ”€â”€ gulpfile.js
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.main.json ä¸»è¿›ç¨‹ç”¨çš„tsconfig
â”œâ”€â”€ tsconfig.render.json æ¸²æŸ“è¿›ç¨‹ç”¨çš„tsconfig
â”œâ”€â”€ tsconfig.test.json æµ‹è¯•ä»£ç ç”¨çš„tsconfig
â”œâ”€â”€ webpack.config.js
â””â”€â”€ yarn.lock
```

é¡¹ç›®ç»“æ„æ¯”è¾ƒå¤æ‚äº†ï¼Œæœ‰ä¸‰ä¸ªéƒ¨åˆ†çš„ä»£ç ï¼šmainï¼Œrenderï¼Œtestã€‚ä¸‰ä¸ªéƒ¨åˆ†å„æœ‰äº¤é›†ï¼Œä½†æ˜¯åœ¨ç”Ÿæˆä¸Šçš„è§„åˆ™åˆæœ‰äº›ä¸ä¸€æ ·ã€‚

- mainï¼šä½¿ç”¨gulp-typescriptç¼–è¯‘main/commonçš„ä»£ç ï¼Œå¹¶è¾“å‡ºåˆ°dist
- renderï¼šä½¿ç”¨webpack-streamæ‰“åŒ…render/commonçš„ä»£ç ï¼Œå¹¶è¾“å‡ºåˆ°dist
- testï¼šä½¿ç”¨gulp-typescriptç¼–è¯‘main/render/commonçš„ä»£ç ï¼Œå¹¶è¾“å‡ºåˆ°test-outï¼Œæ‰§è¡Œæµ‹è¯•

ç›®å‰gulpçš„å®Œç¾å†™æ³•ä¸ºï¼š

```js
const mainCode = ['src/main/**/*.ts*', 'src/common/**/*.ts*'];
const renderCode = ['src/render/**/*.ts*', 'src/common/**/*.ts*'];
const webpackConfig = require('./webpack.config.js');

gulp.task('main', [], function () {
    return gulp.src(mainCode, { base: "./" })
        .pipe(tsMainProject())
        .js.pipe(gulp.dest("dist"));
});

gulp.task('main-w', ['main'], function () {
    gulp.watch(mainCode, ['main']);
});

function webpackTask(watch) {
    return gulp.src('src/render/index.tsx')
        .pipe(webpack(_.merge(webpackConfig, { watch: watch }), null, function (err, stat) {
            console.log("webpack error: ", err);
        }).on('error', function (err) {
            // fix issue https://github.com/shama/webpack-stream/issues/34
            console.log("webpack task error:", err);
            // this.emit('end');
        }))
        .pipe(gulp.dest("./dist"));
}

gulp.task('webpack', function (cb) {
    return webpackTask(false);
});

gulp.task('webpack-w', ['webpack'], function () {
    webpackTask(true);
})

gulp.task('all-w', ['main-w', 'webpack-w'], function () {

});
```

è¿è¡Œ`gulp all-w`å°±èƒ½è‡ªåŠ¨ç›‘è§†ç¼–è¯‘mainå’Œrenderçš„ä»£ç ï¼Œç®€ç›´çˆ½ã€‚

### 2017å¹´01æœˆ19æ—¥ æ˜ŸæœŸå›› åœ¨electronä¸­å®‰è£…è°ƒè¯•æ’ä»¶

å‚è€ƒ[chentsulin/electron-react-boilerplate](https://github.com/chentsulin/electron-react-boilerplate)å®‰è£…ä¸€ä¸‹æ’ä»¶ï¼š

- Devtron - Electronå®˜æ–¹æä¾›çš„è°ƒè¯•æ’ä»¶ - Install via electron-debug.
- React Developer Tools - Reactå®˜æ–¹æä¾›çš„è°ƒè¯•æ’ä»¶ - Install via electron-devtools-installer.
- Redux DevTools - Reduxè°ƒè¯•æ’ä»¶ - Install via electron-devtools-installer.

ä½¿ç”¨[MarshallOfSound/electron-devtools-installer](https://github.com/MarshallOfSound/electron-devtools-installer)åœ¨Electronä¸­å®‰è£…è°ƒè¯•æ’ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
function installChromeExtensions() {
  if (process.env.NODE_ENV === constant.env.nodeEnv.development) {
    const installer = require('electron-devtools-installer');

    const extensions = [
      'REACT_DEVELOPER_TOOLS',
      'REDUX_DEVTOOLS'
    ]

    const forceDownload = !!process.env.UPGRADE_EXTENSIONS;

    console.log("start to install debug extensions....");
    return Promise
      .all(extensions.map(name => installer.default(installer[name], forceDownload)))
      .then(() => {
        console.log("install debug extensions finish");
      }).catch((err) => {
        console.log("install debug extensions error:" + err);
      });
  }
}
```

åœ¨app readyåè°ƒç”¨å³å¯ã€‚å®‰è£…éœ€è¦ç¿»å¢™ã€‚å®‰è£…åå°±ä¸ä¼šå†å®‰è£…äº†ï¼Œè®¾ç½®`UPGRADE_EXTENSIONS`å¯ä»¥å¼ºåˆ¶æ›´æ–°ï¼š

```
$ UPGRADE_EXTENSIONS=1 npm run dev

# For Windows
$ set UPGRADE_EXTENSIONS=1 && npm run dev
```

ç„¶åå’±

```
npm install --save-dev devtron

require('devtron').install()
```

### 2017å¹´01æœˆ23æ—¥ æ˜ŸæœŸä¸€ react-redux 

å­¦ä¹ react-reduxã€‚å¤§è‡´çœ‹äº†reduxçš„ä»£ç ï¼Œä»£ç çœŸå¿ƒå°‘ã€‚ä½†æ˜¯å­¦ä¹ èµ·æ¥å´è¿™ä¹ˆä¸å®¹æ˜“ã€‚ã€‚ã€‚ã€‚

è€Œä¸”è¿˜å¯ä»¥å¾ˆå¼ºå¤§ã€‚æˆ–è®¸è¿™å°±æ˜¯UNIXè®¾è®¡è‰ºæœ¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹è¯ã€‚

ç»“åˆè°ƒè¯•æ‰©å±•ï¼ŒçœŸæ˜¯å¯ä»¥åœ¨åº”ç”¨çŠ¶æ€ä¸­è¿›è¡Œæ—¶é—´æ—…è¡Œï¼š

- [redux-devtools](https://github.com/gaearon/redux-devtools)
- [Redux-devToolsç®€å•çš„ä½¿ç”¨ - ç®€ä¹¦](http://www.jianshu.com/p/a2d4c1856560)

ä½†æ˜¯ä¸å¾—ä¸è¯´ï¼Œçš„ç¡®å¾ˆéš¾æ¶ˆåŒ–ï¼Œæˆ‘ç°åœ¨è¿˜æ˜¯æ— æ³•ç”¨å…¶å¼€å§‹å†™mmnoteã€‚

è¿˜æœ‰ï¼Œå¯¹äºstateï¼Œæ¯æ¬¡éƒ½è¦è¿”å›ä¸€ä¸ªæ–°çš„objectä¹ˆï¼Ÿ -- å¯¹çš„ã€‚

### 2017å¹´01æœˆ24æ—¥ æ˜ŸæœŸäºŒ immutable.js

immutable.jsæ˜¯jsä¸­çš„ä¸å¯å˜æ•°æ®ç±»å‹åº“ã€‚å…¶å®ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œå°¤å…¶æ˜¯è·å–åµŒå¥—çš„å±æ€§ã€‚

- [Immutable è¯¦è§£åŠ React ä¸­å®è·µ Â· Issue #3 Â· camsong/blog](https://github.com/camsong/blog/issues/3)
- [How to Build a Todo App Using React, Redux, and Immutable.js](https://www.sitepoint.com/how-to-build-a-todo-app-using-react-redux-and-immutable-js/)

Immutable.jså’Œreduxç»“åˆæœ‰äº›é—®é¢˜ï¼Œå› ä¸ºcombineReducersé’ˆå¯¹çš„æ˜¯æ™®é€šObjectã€‚

æœ‰ä¸€ä¸ªåº“å®ç°äº†é’ˆå¯¹immutable.jsçš„combineReducersï¼š

- [gajus/redux-immutable: redux-immutable is used to create an equivalent function of Redux combineReducers that works with Immutable.js state.](https://github.com/gajus/redux-immutable)

jsçš„ä¸–ç•Œå°±æ˜¯å¦‚æ­¤ï¼Œè¿™ä¸ªåº“ä¹Ÿä¸è¿‡ä¸€ç™¾æ¥è¡Œï¼Œæœ‰800å¤šstartã€‚ã€‚ã€‚ã€‚

- [è§£è¯»reduxå·¥ä½œåŸç† - dry - SegmentFault](https://segmentfault.com/a/1190000004236064?utm_source=Weibo)

### 2017å¹´01æœˆ26æ—¥ æ˜ŸæœŸå›› å¼‚æ­¥action ä½¿ç”¨æ²¡æœ‰ç±»å‹å®šä¹‰çš„åŒ…

reduxçš„middlewareæœ‰å‡ ä¸ªé€‰æ‹©ï¼š

- æ ‡å‡†çš„åšæ³•æ˜¯ä½¿ç”¨ Redux Thunk middlewareã€‚è¦å¼•å…¥ redux-thunk è¿™ä¸ªä¸“é—¨çš„åº“æ‰èƒ½ä½¿ç”¨ã€‚æˆ‘ä»¬åé¢ä¼šä»‹ç» middleware å¤§ä½“ä¸Šæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼›ç›®å‰ï¼Œä½ åªéœ€è¦çŸ¥é“ä¸€ä¸ªè¦ç‚¹ï¼šé€šè¿‡ä½¿ç”¨æŒ‡å®šçš„ middlewareï¼Œaction åˆ›å»ºå‡½æ•°é™¤äº†è¿”å› action å¯¹è±¡å¤–è¿˜å¯ä»¥è¿”å›å‡½æ•°ã€‚è¿™æ—¶ï¼Œè¿™ä¸ª action åˆ›å»ºå‡½æ•°å°±æˆä¸ºäº† thunkã€‚
- redux-promise æˆ–è€… redux-promise-middleware æ¥ dispatch Promise æ›¿ä»£å‡½æ•°ã€‚
- redux-observable æ¥ dispatch Observableã€‚
- redux-saga ä¸­é—´ä»¶æ¥åˆ›å»ºæ›´åŠ å¤æ‚çš„å¼‚æ­¥ actionã€‚

- [Netflix JavaScript Talks - RxJS + Redux + React = Amazing! - YouTube](https://www.youtube.com/watch?v=AslncyG8whg&ab_channel=NetflixUIEngineering)

è¿™ä¸ªæ°´ä¹Ÿå¥½æ·±ï¼Œä¸æƒ³å†è¿™ä¸ªé˜¶æ®µå¤šèŠ±æ—¶é—´åœ¨ä¸Šé¢äº†ï¼Œé‡‡ç”¨æœ€ç®€å•åŸå§‹çš„`redux-thunk`

`isomorphic-fetch`è¿™ä¸ªåº“ä¸é”™ï¼Œç”¨èµ·æ¥ã€‚

---

å¯¹äºä½¿ç”¨æ²¡æœ‰ç±»å‹å®šä¹‰çš„åŒ…ï¼Œä½¿ç”¨`index.d.ts`ï¼Œç„¶åç®€å•çš„å†™ï¼š

```
declare module 'redux-devtools-chart-monitor';
declare module 'redux-devtools-diff-monitor';
declare module 'redux-devtools-inspector';
```

ç„¶å`/// <reference path="./index.d.ts" />`

2017å¹´01æœˆ28æ—¥ åˆä¸€ codemirror å‰ªè´´æ¿å›¾ç‰‡

```js
(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("../markdown/markdown"), require("../../addon/mode/overlay"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "../markdown/markdown", "../../addon/mode/overlay"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
```

é™¤äº†åŸå§‹æµè§ˆå™¨ç¯å¢ƒï¼Œå…¶ä»–ç¯å¢ƒä¸­å¼•å…¥gfm modeå°±ä¼šè‡ªåŠ¨å¼•å…¥ä¾èµ–çš„markdown modeå’Œoverlayæ’ä»¶ã€‚

å…ˆä¸å¼„æ ‘æ§ä»¶äº†ï¼Œä½œä¸ºä¸€ä¸ªæ’ä»¶å®ç°å§(?)ã€‚

æ¥ä¸‹æ¥åšè·å–å‰ªè´´æ¿å›¾ç‰‡ã€‚


- è¿™ç¯‡æ–‡ç« ä¸­CMä½œè€…ä½¿ç”¨changeäº‹ä»¶å¤„ç†ç²˜è´´æ–‡å­—çš„åšæ³•å€¼å¾—å­¦ä¹  [Paste with indent? Â· Issue #2120 Â· codemirror/CodeMirror](https://github.com/codemirror/CodeMirror/issues/2120)

ä½¿ç”¨changeå¯¹è±¡çš„origin==='paste'æ¥å¤„ç†ç²˜è´´çš„åœºæ™¯ã€‚ä½†æ˜¯ç²˜è´´å›¾ç‰‡ä¸ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚

```js
// src/input/input.js
export function handlePaste(e, cm) {
  let pasted = e.clipboardData && e.clipboardData.getData("Text")
  if (pasted) {
    e.preventDefault()
    if (!cm.isReadOnly() && !cm.options.disableInput)
      runInOp(cm, () => applyTextInput(cm, pasted, 0, null, "paste"))
    return true
  }
}
```

CMçš„é»˜è®¤å¤„ç†ï¼Œå¦‚æœä¸æ˜¯æ–‡å­—ï¼Œæ˜¯ä¸ä¼šæœ‰è¡Œä¸ºçš„ã€‚

å›¾ç‰‡æ‹–æ‹½ä¸Šä¼ æ’ä»¶ï¼š
- â­ï¸[jsæ‹–æ‹½ç²˜è´´ä¸Šä¼ ä¸CodeMirror - å°å°æ‡’ç¾Šç¾ŠSFä¸“æ  - SegmentFault](https://segmentfault.com/a/1190000007434697)
- [Rovak/InlineAttachment: Easily paste and upload files/images in plain textareas](https://github.com/Rovak/InlineAttachment)

widget demoå€¼å¾—å­¦ä¹ ï¼š
- [CodeMirror: Inline Widget Demo](https://codemirror.net/demo/widget.html)

å‚è€ƒä¸Šé¢çš„æ–‡ç« çŸ¥é“äº†åšæ³•ï¼š

```js
myCodeMirror.on('paste',function(instance, e){
    console.log('paste',instance,e);
    e.preventDefault();
});

e.clipboardData.items[0].getAsFile()
// => Blob {size: 12312, type: "image/png"}
```

å¦‚ä½•ä¿å­˜Blobåˆ°æ–‡ä»¶ä¸­ï¼Ÿ

- [blob-to-buffer](https://www.npmjs.com/package/blob-to-buffer)

ä½¿ç”¨è¿™ä¸ªåº“æŠŠblobè½¬ä¸ºbufferå³å¯ã€‚

åŒæ—¶å‘ç°äº†ä¾èµ–è¿™ä¸ªåº“çš„ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é¡¹ç›®ï¼š

- [blob-to-buffer](https://www.npmjs.com/package/blob-to-buffer)

åŸºäºCMçš„markdownç¼–è¾‘å™¨ï¼Œåšå¾—å¾ˆä¸é”™ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½åœ¨ç”¨ï¼š
- â­ï¸[NextStepWebs/simplemde-markdown-editor: A simple, beautiful, and embeddable JavaScript Markdown editor. Delightful editing for beginners and experts alike. Features built-in autosaving and spell checking.](https://github.com/NextStepWebs/simplemde-markdown-editor)

---

å¯ä»¥ä»å‰ªè´´æ¿ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°äº†ï¼Œä½†æ˜¯å›¾ç‰‡æ¸…æ™°åº¦ä¸å¤Ÿï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç±»ä¼¼çš„é—®é¢˜ï¼š

- [Javascript: How do I access Hi-DPI/Retina image from the clipboard on a paste event? - Stack Overflow](http://stackoverflow.com/questions/22135549/javascript-how-do-i-access-hi-dpi-retina-image-from-the-clipboard-on-a-paste-ev)

ä½†æ˜¯æ²¡æœ‰å›ç­”ã€‚æˆ‘çœ‹äº†githubçš„markdownç¼–è¾‘æ§ä»¶ï¼Œä¸Šä¼ çš„å›¾ç‰‡æ˜¯é«˜æ¸…çš„ã€‚ã€‚ã€‚å¦‚ä½•åšåˆ°ã€‚

è¦è¢«æ•´ç–¯äº†ã€‚ã€‚ã€‚

![](../../../img/2017-01-28-23-44-47.png)

### 2017å¹´01æœˆ29æ—¥ æ˜ŸæœŸæ—¥

- [Chrome 54 update by groundwater Â· Pull Request #7909 Â· electron/electron](https://github.com/electron/electron/pull/7909)
- [355477 - Pasting images doesn't preserve original resolution - chromium - Monorail](https://bugs.chromium.org/p/chromium/issues/detail?id=355477)

è¿™ä¸ªäººé—®çš„é—®é¢˜ä¸€æ¨¡ä¸€æ ·ã€‚éš¾é“è¿™ä¸ªé—®é¢˜è¿™ä¹ˆå¤šå¹´äº†æ²¡äººç®¡ï¼Ÿï¼Ÿï¼Ÿ

ç°åœ¨æˆ‘ç”¨çš„æµè§ˆå™¨æ˜¯55ï¼Œè€Œelectronä½¿ç”¨çš„æ˜¯53ã€‚ä¸‹è½½ä¸€ä¸ª53çš„chromeçœ‹çœ‹ã€‚

è€ç‰ˆæœ¬ç½‘å€ï¼š
- [Google Chrome old versions - Mac](http://google-chrome.en.uptodown.com/mac/old)
- [Google Chrome 56.0.2924.76-å†å² -FileHippo.com](http://filehippo.com/zh/mac/download_google_chrome_for_mac/history)

å…³é—­è‡ªåŠ¨æ›´æ–°ï¼š
- [How to install a previous version of Chrome in Mac / Advanced Questions / Knowledge Base - Imonggo Support](http://support.imonggo.com/help/kb/advance-questions/how-to-install-a-previous-version-of-chrome-in-mac)
- [How to Stop Google Chrome from Auto-Updates for Mac / Advanced Questions / Knowledge Base - Imonggo Support](http://support.imonggo.com/help/kb/advance-questions/how-to-stop-google-chrome-from-auto-updates-for-mac)

```
defaults read com.google.Keystone.Agent checkInterval // => 18000

å…³é—­ï¼š
defaults write com.google.Keystone.Agent checkInterval 0
```

æ§åˆ¶å°ä¸­æ£€æŸ¥ç‰ˆæœ¬ï¼š

```
navigator.appVersion
```

å®éªŒç½‘å€ï¼šhttp://jsfiddle.net/zd5pX/44/

```html
<div>Click this pane, and paste</div>
<img src="" alt="" id="img">
```

```js
$('html').bind('paste', function(e) {
    e.preventDefault();
    var item = (e.clipboardData || e.originalEvent.clipboardData).items[0];
    var type = item.type.split('/').shift();
    if (type == "image"){
        var file = item.getAsFile();
        var blob = URL.createObjectURL(file); // Blob
        document.getElementById('img').src = blob;
    }
});
```

ç»“è®ºï¼š55ç‰ˆæœ¬ä¸­æ‰ä¿®å¤ã€‚electronä¸‹ä¸ªç‰ˆæœ¬ä¸º1.5.0ï¼Œä½¿ç”¨çš„chromeç‰ˆæœ¬ä¸º54ã€‚ã€‚ã€‚ã€‚ç­‰å§ã€‚

### 2017å¹´02æœˆ03æ—¥ æ˜ŸæœŸäº” ç²˜è´´å›¾ç‰‡

å®Œæˆç²˜è´´å›¾ç‰‡ï¼ç›®å‰ä½¿ç”¨çš„æ˜¯inline widgetï¼Œä¹‹åå†ä¼˜åŒ–åˆ«çš„å½¢å¼ã€‚

![](/img/mmnote-can-paste-image.png)

ä¸‹ä¸€æ­¥æ˜¯å®æ—¶é¢„è§ˆã€‚ç„¶åæ˜¯å›¾ç‰‡å¯ä»¥åˆ é™¤ã€‚

### 2017å¹´02æœˆ05æ—¥ æ˜ŸæœŸæ—¥ 

å­¦ä¹ Abricotineï¼Œä½¿ç”¨`is-url`æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯url

å½“å‰é—®é¢˜ï¼šmarkTextåï¼Œå…‰æ ‡æœ‰äº›é—®é¢˜

### 2017å¹´02æœˆ08æ—¥ æ˜ŸæœŸä¸‰

> é—®é¢˜ï¼šmarkTextåï¼Œå…‰æ ‡æœ‰äº›é—®é¢˜

è§£å†³ï¼š

```js
let element = document.createElement('img');
element.src = 'file://' + link;

let marker = doc.markText(from, to, {
    replacedWith: element,
    handleMouseEvents: true
});

element.addEventListener("load", function () {
    marker.changed();
});
```

éœ€è¦è°ƒç”¨`marker.changed()`ï¼Œè¿™æ ·CMä¼šæ›´å…·å½“å‰markerçš„å¤§å°æ¥æ›´æ–°ç¼–è¾‘å™¨ä»¥åŠå…‰æ ‡ã€‚

- [Typing Destructured Object Parameters in TypeScript | Marius Schulz](https://blog.mariusschulz.com/2015/11/13/typing-destructured-object-parameters-in-typescript)

å½“å‰ä»»åŠ¡ï¼š[task-11]é”™è¯¯çš„å›¾ç‰‡é€»è¾‘ï¼š
1. æ ‡çº¢
2. ç¼–è¾‘è¿‡ç¨‹ä¸­å¦‚æœä¸åœ¨æ»¡è¶³å›¾ç‰‡è¯­æ³•ï¼Œåˆ™é€€åŒ–ä¸ºæ™®é€šæ–‡æœ¬
3. ç¼–è¾‘è¿‡ç¨‹ä¸­å¦‚æœå›¾ç‰‡åˆæ³•äº†ï¼Œåˆ™æ¸²æŸ“ä¸ºå›¾ç‰‡

### 2017å¹´02æœˆ09æ—¥ æ˜ŸæœŸå›› åˆ—è¡¨è¡¥å…¨ æ ‡é¢˜å¤§å°åŒºåˆ†
ä½¿ç”¨imgçš„erroräº‹ä»¶å®Œæˆé”™è¯¯å¤„ç†çš„éœ€æ±‚[task-11]ã€‚

ä¸‹ä¸€æ­¥ä»»åŠ¡ï¼šå®Œå–„ç¼–è¾‘ä½“éªŒï¼ˆå­¦ä¹ SimpleMDEï¼‰

1. [task-12-âœ…]åˆ—è¡¨ç­‰å›è½¦ä¼šè‡ªåŠ¨è¡¥å…¨å‰ç¼€ 
2. [task-13]ä»£ç å—èƒŒæ™¯è‰²
3. [task-14-âœ…]ä¸åŒçº§åˆ«çš„æ ‡é¢˜å¤§å°ä¸ä¸€æ · 
4. [task-15]å›¾ç‰‡è¢«é€‰ä¸­æ—¶ï¼Œå˜è‰²
5. å­¦ä¹ å¦‚ä½•ç¼–å†™codemirror mode
6. [task-16]å›¾ç‰‡å®½åº¦æœ€å¤§ä¸ºç¼–è¾‘å™¨å®½åº¦

**[task-12]:**

`addon/edit/continuelist.js`,è¿™ä¸ªæ’ä»¶æ·»åŠ äº†`newlineAndIndentContinueMarkdownList`å‘½ä»¤ï¼Œå°†ä»–ç»‘å®šåˆ°Enterä¸Šå³å¯ã€‚

```js
var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    mode: 'gfm',
    lineNumbers: true,
    theme: "default",
    extraKeys: {"Enter": "newlineAndIndentContinueMarkdownList"}
});
```

**[task-14]ï¼š**

åœ¨cssä¸­æ·»åŠ `.CodeMirror .CodeMirror-code .cm-header-1~4`çš„æ ·å¼å³å¯ï¼š

```css
.CodeMirror .CodeMirror-code .cm-header-1 {
    font-size: 200%;
    line-height: 200%;
}

.CodeMirror .CodeMirror-code .cm-header-2 {
    font-size: 160%;
    line-height: 160%;
}

.CodeMirror .CodeMirror-code .cm-header-3 {
    font-size: 125%;
    line-height: 125%;
}

.CodeMirror .CodeMirror-code .cm-header-4 {
    font-size: 110%;
    line-height: 110%;
}
```

### 2017å¹´02æœˆ10æ—¥ æ˜ŸæœŸå…­ æ‰“åŒ… ç¼–è¾‘å™¨å¡é¡¿æ’æŸ¥

`beforeSelectionChange`äº‹ä»¶ï¼Œä¼šåœ¨é€‰åŒºå˜åŒ–æ—¶ï¼Œä½†æ˜¯ç”Ÿæ•ˆå‰è§¦å‘ï¼Œè¿”å›çš„å¯¹è±¡åŒ…å«ï¼š{ranges, origin, update}ï¼Œå¯ä»¥è°ƒç”¨updateæ–¹æ³•æ¥æ›´æ–°é€‰åŒºã€‚

å®Œæˆæ–‡ç« ï¼š[æ‰“åŒ…Electronåº”ç”¨ | æœ¨æ‰çš„åšå®¢](http://mushanshitiancai.github.io/2017/02/11/js/electron/%E6%89%93%E5%8C%85Electron%E5%BA%94%E7%94%A8/)

ç›®å‰æ”¯æŒç²˜è´´/é¢„è§ˆå›¾ç‰‡çš„æœ€æ–°DEMOï¼š

![](/img/mmnote-demo-170210.png)

å¤§è‡´çš„æ¶æ„å›¾ï¼š

![](/img/mmnote-architecture-170211.svg)

ä¸‹ä¸€æ­¥ä»»åŠ¡ï¼š

1. [task-17-âŒ]æ›´æ–°æ–‡æ¡£çš„stateç»“æ„ï¼Œåœ¨ç¼–è¾‘å™¨ç¼–è¾‘æ—¶ï¼Œä¸æ›´æ–°stateï¼ˆå¦‚æœæ›´æ–°ä¼šå¯¼è‡´æ•ˆç‡ä½ä¸‹ï¼‰ã€‚åªåœ¨saveæ—¶æ›´æ–°stateã€‚

Editorç°åœ¨ä¼ å…¥çš„propsæ˜¯ä¸€ä¸ªurlï¼Œè¿™ä¸ªä¸å¤ªä¸å’Œç›®å‰çš„é€»è¾‘äº†ã€‚ç›®å‰ä½¿ç”¨äº†CMçš„Docï¼Œæ‰€ä»¥ä¸€ä¸ªeditorå…¶å®æ‰¿è½½äº†å¤šä¸ªdocï¼Œåªæ˜¯åŒæ—¶åªæ˜¾ç¤ºå½“å‰docã€‚

=> å‘ç°å¦‚æœåœ¨ç¼–è¾‘å™¨æ›´æ–°æ—¶ä¸æ›´æ–°stateï¼Œé‚£ä¹ˆå°±ä¸æ˜¯react+reduxçš„æ¨¡å¼äº†ï¼Œå†™èµ·æ¥æ— ä»ä¸‹æ‰‹ã€‚ã€‚ã€‚å‚è€ƒäº†[JedWatson/react-codemirror](https://github.com/JedWatson/react-codemirror)ï¼Œå‘ç°ä»–çš„æ›´æ–°æ¨¡å¼å’Œæˆ‘ä¹‹å‰å†™çš„ä¸€æ ·ï¼Œå…ˆonChangeï¼Œç„¶åæ›´æ–°propsåå†æ¯”è¾ƒvalueï¼Œè¿™æ ·çœ‹èµ·æ¥çœŸçš„æ˜¯éå¸¸ä½æ•ˆå•Šã€‚ä½†æ˜¯ä»–çš„demoå¹¶æ²¡æœ‰å‡ºç°å¡é¡¿çš„ç°è±¡ã€‚

ç»è¿‡æ’æŸ¥ï¼Œå‘ç°å¦‚æœå…³é—­Reduxçš„DevToolsä¸­é—´ä»¶ï¼Œå¡é¡¿å°±æ¶ˆå¤±äº†ã€‚çœ‹æ¥æ˜¯å› ä¸ºè¾“å…¥æ—¶é¢‘ç¹æ›´æ–°stateï¼Œå¯¼è‡´devtoolå‡ºç°ç“¶é¢ˆï¼ˆäººå®¶æ¯•ç«Ÿæ˜¯æä¾›æ—¶é—´æ—…è¡Œçš„ã€‚ã€‚ã€‚ï¼‰

### 2017å¹´02æœˆ12æ—¥ æ˜ŸæœŸæ—¥ äº†è§£Draft.js File URI stateæ€è€ƒ

- [Draft.js | Rich Text Editor Framework for React](https://facebook.github.io/draft-js/)

è¿™æ˜¯simplenoteä½¿ç”¨çš„ç¼–è¾‘å™¨æ§ä»¶ï¼Œæ˜¯Facebookæ¨å‡ºçš„ä¸€ä¸ªåŸç”Ÿæ”¯æŒReactçš„ç¼–è¾‘å™¨ã€‚

1. [task-18-âœ…]Draft.jsæ˜¯å¦‚ä½•æ¥å—å¤–éƒ¨æŒ‡ä»¤çš„ï¼Ÿæ¯”å¦‚replaceï¼Ÿ

---

ä¸ºäº†æ‰€è°“ä¹‹æ‰©å±•æ€§ï¼Œæ‰€æœ‰çš„ç¬”è®°è·¯å¾„ä½¿ç”¨uriæ ¼å¼

- [file URI scheme - Wikipedia](https://en.wikipedia.org/wiki/File_URI_scheme#cite_note-2)
- [File URIs in Windows â€“ IEBlog](https://blogs.msdn.microsoft.com/ie/2006/12/06/file-uris-in-windows/)

å·¥å…·ï¼š
- [medialize/URI.js: Javascript URL mutation library](https://github.com/medialize/URI.js)

æˆ‘éœ€è¦çš„èƒ½åŠ›ï¼š

1. åˆ¤æ–­åè®®
2. å¦‚æœæ˜¯fileï¼Œè·å–å¯¹åº”çš„æœ¬åœ°pathï¼ˆ[TooTallNate/file-uri-to-path: Convert a file: URI to a file path](https://github.com/TooTallNate/file-uri-to-path)ï¼‰
3. æœ¬åœ°pathå˜ä¸ºfile uriï¼ˆ[file-url](https://www.npmjs.com/package/file-url)ï¼‰

```
yarn add urijs file-uri-to-path file-url
yarn add @types/urijs @types/file-url
```

```ts
declare module 'file-uri-to-path' {
    function uri2path(uri: string): string;
    export = uri2path;
}
```

---

ç°åœ¨stateçš„å®šä¹‰å’Œä½¿ç”¨éƒ½éå¸¸çš„ä¸æ–¹ä¾¿ï¼ğŸ˜¤

å› ä¸ºä½¿ç”¨äº†immutable.jsï¼Œå¯¼è‡´è·å–å’Œæ›´æ–°éƒ½éå¸¸çš„ä¸æ–¹ä¾¿ï¼Œè·å–å¿…é¡»ä½¿ç”¨getï¼Œç±»å‹å®šä¹‰å®Œå…¨æ— æ•ˆäº†ï¼Œè€Œä¸”åµŒå¥—çš„è¿˜å¾—ä½¿ç”¨get(['a','b']),ç®€ç›´æ¶å¿ƒåˆ°é€†å¤©ï¼Œè€Œä¸”stateæ›´æ–°è¿˜å¿…é¡»ä»é¡¶çº§å¾€ä¸‹æ›´æ–°æ‰è¡Œã€‚

å‚è€ƒäº†draft.jså’Œsimplenoteï¼Œæœ‰äº†å‡ ç‚¹ç»“è®ºï¼š

1. çŠ¶æ€çš„ç»´æŠ¤æ¯”è¾ƒæ¶å¿ƒæ˜¯ä¸å¯é¿å…çš„ï¼Œå› ä¸ºdraft.jsä¸­ï¼Œæ›´æ–°EditorStateä¹Ÿä¸ç®€å•ï¼Œéƒ½æ˜¯ä»EditorStateè¿™ä¸ªé¡¶çº§stateå¼€å§‹æ›´æ–°å…¶ä¸­çš„å­stateçš„ï¼Œä½¿ç”¨setæˆ–è€…putï¼Œæˆ–è€…utilã€‚ã€‚ã€‚
2. è·å–çŠ¶æ€å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„æ–¹æ³•æ¥è·å–ï¼Œå…¶ä¸­åŒ…è£…immutableçš„getï¼Œè¿™æ ·ä¸ä¼šæ¶å¿ƒåˆ°å¤–é¢å»ï¼Œä½†æ˜¯é‡å¤ä»£ç é‡å¾ˆå¤šã€‚ã€‚ã€‚ã€‚
3. draft.jsæ¯”è¾ƒè±ªåï¼Œæ‰€æœ‰å­çŠ¶æ€ï¼Œåªè¦ä¸æ˜¯ç®€å•ç±»å‹çš„ï¼Œéƒ½æ˜¯è‡ªå®šä¹‰Recordæˆ–è€…è‡ªå®šä¹‰å…¶ä»–æ•°æ®ç»“æ„ï¼Œæ ·æ¿ä»£ç é‡å¾ˆå¤§ã€‚
4. stateå°½é‡æ‰å¹³åŒ–å§ï¼Œä¼šä¸é‚£ä¹ˆæ¶å¿ƒä¸€ç‚¹ï¼Œæ¯”å¦‚simplenoteåŸºæœ¬åªæœ‰ä¸€å±‚
5. simplenoteæŠŠè¿œç«¯æœåŠ¡çš„Bucketç›´æ¥æ”¾åˆ°stateä¸­å»ï¼Œè¿™æ ·åšå¥½å—ï¼Ÿ

### 2017å¹´02æœˆ13æ—¥ æ˜ŸæœŸä¸€ 

ç»§ç»­çº ç»“reduxçš„stateçš„é—®é¢˜ã€‚

- [State èŒƒå¼åŒ– | Redux ä¸­æ–‡æ–‡æ¡£ Join the chat at https://gitter.im/camsong/redux-in-chinese](http://cn.redux.js.org/docs/recipes/reducers/NormalizingStateShape.html)

> ä¸Šé¢çš„æ•°æ®ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œå¹¶ä¸”æœ‰éƒ¨åˆ†æ•°æ®æ˜¯é‡å¤çš„ã€‚è¿™é‡Œè¿˜å­˜åœ¨ä¸€äº›è®©äººå…³å¿ƒçš„é—®é¢˜ï¼š
> 1. å½“æ•°æ®åœ¨å¤šå¤„å†—ä½™åï¼Œéœ€è¦æ›´æ–°æ—¶ï¼Œå¾ˆéš¾ä¿è¯æ‰€æœ‰çš„æ•°æ®éƒ½è¿›è¡Œæ›´æ–°ã€‚
> 2. åµŒå¥—çš„æ•°æ®æ„å‘³ç€ reducer é€»è¾‘åµŒå¥—æ›´å¤šã€å¤æ‚åº¦æ›´é«˜ã€‚å°¤å…¶æ˜¯åœ¨æ‰“ç®—æ›´æ–°æ·±å±‚åµŒå¥—æ•°æ®æ—¶ã€‚
> 3. ä¸å¯å˜çš„æ•°æ®åœ¨æ›´æ–°æ—¶éœ€è¦çŠ¶æ€æ ‘çš„ç¥–å…ˆæ•°æ®è¿›è¡Œå¤åˆ¶å’Œæ›´æ–°ï¼Œå¹¶ä¸”æ–°çš„å¯¹è±¡å¼•ç”¨ä¼šå¯¼è‡´ä¸ä¹‹ connect çš„æ‰€æœ‰ UI ç»„ä»¶éƒ½é‡å¤ renderã€‚å°½ç®¡è¦æ˜¾ç¤ºçš„æ•°æ®æ²¡æœ‰å‘ç”Ÿä»»ä½•æ”¹å˜ï¼Œå¯¹æ·±å±‚åµŒå¥—çš„æ•°æ®å¯¹è±¡è¿›è¡Œæ›´æ–°ä¹Ÿä¼šå¼ºåˆ¶å®Œå…¨æ— å…³çš„ UI ç»„ä»¶é‡å¤ render
> æ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨ Redux Store ä¸­ç®¡ç†å…³ç³»æ•°æ®æˆ–åµŒå¥—æ•°æ®çš„æ¨èåšæ³•æ˜¯å°†è¿™ä¸€éƒ¨åˆ†è§†ä¸º**æ•°æ®åº“**ï¼Œå¹¶ä¸”å°†æ•°æ®æŒ‰èŒƒå¼åŒ–å­˜å‚¨ã€‚

- [ä¸å¯å˜æ›´æ–°æ¨¡å¼ | Redux ä¸­æ–‡æ–‡æ¡£ Join the chat at https://gitter.im/camsong/redux-in-chinese](http://cn.redux.js.org/docs/recipes/reducers/ImmutableUpdatePatterns.html)

> æ­£ç¡®æ–¹æ³•ï¼šå¤åˆ¶åµŒå¥—æ•°æ®çš„æ‰€æœ‰å±‚çº§

> ä¸å¹¸çš„æ˜¯ï¼Œæ­£ç¡®åœ°ä½¿ç”¨ä¸å˜çš„æ›´æ–°å»æ·±åº¦åµŒå¥—çŠ¶æ€çš„è¿‡ç¨‹å¾ˆå®¹æ˜“å˜å¾—å†—é•¿éš¾è¯»ã€‚ æ›´æ–° ate.first.second[someId].fourth çš„ç¤ºä¾‹å¤§æ¦‚å¦‚ä¸‹æ‰€ç¤ºï¼š

    ```
    function updateVeryNestedField(state, action) {
        return {
            ....state,
            first : {
                ...state.first,
                second : {
                    ...state.first.second,
                    [action.someId] : {
                        ...state.first.second[action.someId],
                        fourth : action.someValue
                    }
                }
            }
        }
    }
    ```

> æ˜¾ç„¶ï¼Œæ¯ä¸€å±‚åµŒå¥—ä½¿å¾—é˜…è¯»æ›´åŠ å›°éš¾ï¼Œå¹¶ç»™äº†æ›´å¤šçŠ¯é”™çš„æœºä¼šã€‚è¿™æ˜¯å…¶ä¸­ä¸€ä¸ªåŸå› ï¼Œé¼“åŠ±ä½ ä¿æŒçŠ¶æ€æ‰å¹³ï¼Œå°½å¯èƒ½æ„å»º reducerã€‚

ç®€ç›´æ˜¯ç¾éš¾ã€‚ã€‚ã€‚ã€‚

immutableçš„Cursorç”¨èµ·æ¥ï¼š

```js
var Cursor = require('immutable/contrib/cursor');
```

- [Immutable è¯¦è§£åŠ React ä¸­å®è·µ - pure render - SegmentFault](https://segmentfault.com/a/1190000003910357)

### 2017å¹´02æœˆ18æ—¥ æ˜ŸæœŸå…­ tree-viewç»“åˆRedux è½¯é“¾æ¥å¤„ç† fs-promise

Redux å®˜æ–¹ [Tree View](https://github.com/reactjs/redux/tree/master/examples/tree-view) ç¤ºä¾‹:

```
git clone https://github.com/reactjs/redux.git

cd redux/examples/tree-view
npm install
npm start
```

open http://localhost:3000/

> è¯¥ç¤ºä¾‹å±•ç¤ºäº†æ·±å±‚åµŒå¥—æ ‘çŠ¶è§†å›¾çš„æ¸²æŸ“ï¼Œä»¥åŠä¸ºäº†æ–¹ä¾¿ reducer æ›´æ–°ï¼Œstate çš„æ ‡å‡†åŒ–å†™æ³•ã€‚ä¼˜è‰¯çš„æ¸²æŸ“è¡¨ç°ï¼Œæ¥è‡ªäºå®¹å™¨ç»„ä»¶ç»†ç²’åº¦çš„ã€ä»…é’ˆå¯¹éœ€è¦æ¸²æŸ“çš„ tree node çš„ç»‘å®šã€‚

è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ ‘ç»“æ„è¢«æ‹‰å¹³äº†ã€‚è¿™æ˜¯reduxçš„stateçš„æ ‡å‡†åŒ–å†™æ³•ï¼Œæ–¹ä¾¿æ›´æ–°ã€‚

```js
let tree = {
    0: {
      id: 0,
      counter: 0,
      childIds: [],
      parentId: null
    }
  }
```

---

ä¸åŒè½¯ä»¶å¯¹äºè½¯é“¾æ¥çš„å¤„ç†æ˜¯å¦‚ä½•çš„å‘¢ï¼Ÿ

![](/img/mmnote-sublime-ln-file.png)

![](/img/mmnote-vscode-ln-file.png)

æˆ‘å€¾å‘äºvscodeï¼Œä½†æ˜¯è½¯é“¾æ¥çš„æ–‡ä»¶å¤¹æ˜¯ä¸æ˜¯åº”è¯¥ç”¨ä¸åŒçš„logoï¼Ÿ

---

ç§»å…¥fs-promiseåï¼Œwebpackä¼šæŠ¥é”™ï¼Œå‚è€ƒï¼š

- [Module parse failed: /.../node_modules/any-promise/LICENSE Unexpected token Â· Issue #27 Â· kevinbeaty/any-promise](https://github.com/kevinbeaty/any-promise/issues/27)

åœ¨webpacké…ç½®ä¸­æ·»åŠ ï¼š

```js
plugins: [
    new webpack.NormalModuleReplacementPlugin(/^any\-promise$/, 'bluebird'),
],
```

### 2017å¹´02æœˆ19æ—¥ æ˜ŸæœŸæ—¥

- [task-19-âœ…]æ•´åˆç›®å½•æ ‘å’Œæ–‡æ¡£

**[task-19]**

è¿™ä¸ªæ•´åˆå®Œï¼Œç¬¬ä¸€é˜¶æ®µå°±å·®ä¸å¤šäº†ã€‚ç°åœ¨æœ‰å‡ ç‚¹ä½“ä¼šï¼š

1. React+Reduxè¿™ä¸€å¥—å¾ˆå¼ºï¼Œä½†æ˜¯æˆ‘ä½œä¸ºä»OOè¿™ä¸ªä½“ç³»è¿‡æ¥çš„ï¼Œè„‘å­è¿˜æ˜¯æ²¡æœ‰å®Œå…¨è½¬è¿‡å¼¯æ¥ï¼Œå¯¹äºä¸æ˜¯â€œç»„ä»¶.æ“ä½œ(æ•°æ®)â€è¿™ç§æ¨¡å¼è¿˜æ˜¯ä¸é€‚ç”¨ï¼Œè€æƒ³ç€ç›´æ¥æ“ä½œç»„ä»¶ã€‚
2. React+Reduxè¿™ä¸€å¥—å¾ˆå¼ºï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥ä¸æ˜¯å¾ˆç®€å•ï¼Œç»„ä»¶çš„ç¼–å†™è¿˜å¥½ï¼Œä½†æ˜¯çŠ¶æ€è¿™ä¸€å—ç®€ç›´ä¸èƒ½å†æ¶å¿ƒäº†ã€‚ã€‚ã€‚è™½ç„¶ç”¨ä¸ŠImmutableåï¼Œæ‹¼è£…æ–°çš„stateè¿”å›è¿™ä¸ªä¸é‚£ä¹ˆä¹±äº†ï¼Œä½†æ˜¯è¯»å–å’Œæ›´æ–°çŠ¶æ€ï¼ŒçœŸå¿ƒéº»çƒ¦ã€‚ã€‚ã€‚è€Œä¸”ç±»å‹ç³»ç»Ÿæ‰‘è¡—

![](/img/mmnote-redux-state-complex.png)

ä¸ºäº†å°½å¿«å§è¿™ä¸ªé¡¹ç›®å†™å‡ºæ¥ï¼Œæœ€è¿‘æœ‰äº›ç„¦è™‘ç—‡äº†ï¼Œå½±å“éšçœ çš„çº§åˆ«ã€‚ã€‚ã€‚çœŸæ‹…å¿ƒèƒƒç‚å› æ­¤åˆçŠ¯äº†ã€‚

![](/img/mmnote-combine-tree-and-editor.png)

### 2017å¹´02æœˆ20æ—¥ æ˜ŸæœŸä¸€

æç¤ºWarningï¼š`Warning: a promise was created in a handler but was not returned from it`

å‚è€ƒï¼š[Warning Explanations | bluebird](http://bluebirdjs.com/docs/warning-explanations.html#warning-a-promise-was-created-in-a-handler-but-was-not-returned-from-it)

ä¾‹å­ï¼š

```js
fsp.stat(path).then(stats => {
    if (stats.isFile()) {
        dispatch(openFileAction(path));
    } else if (stats.isDirectory()) {
        dispatch(openFolderAction(path));
    }
    return null;  // <-- åé¢æœ‰catchæˆ–è€…thenå¿…é¡»åŠ ï¼Œä¸ç„¶å°±è­¦å‘Šäº†
}).catch(sendFailAction(dispatch, ACT_OPEN_FAIL));
```

- [task-20]å›¾ç‰‡å’Œæ–‡å­—åœ¨åŒä¸€è¡Œæ—¶ï¼Œç¼–è¾‘æ–‡å­—ä¸æ­£å¸¸

### 2017å¹´02æœˆ22æ—¥ æ˜ŸæœŸä¸‰

æŸ¥Immutable.jsçš„ç”¨èµ·æ¥ç—›è‹¦çš„èµ„æ–™ï¼Œåˆ°äº†vue.jsï¼Œå‘ç°äº†æåˆ°äº†MobXï¼Œäº†è§£äº†ä¸€ä¸‹ï¼ŒåŸæ¥æ˜¯Reactä¸Šæ–°çš„çŠ¶æ€ç®¡ç†æ¡†æ¶ã€‚æŸ¥äº†ä¸‹ï¼Œéƒ½è¯´æ¯”Reduxå¥½å†™å¾ˆå¤šï¼Œå¤§è‡´äº†è§£ä¸€ä¸‹ï¼Œæ„Ÿè§‰ä¸é”™ã€‚

- [å¯¹æ¯”å…¶ä»–æ¡†æ¶ - vue.js](http://cn.vuejs.org/v2/guide/comparison.html#MobX) 
- [Tutorials, videos and blogs | MobX](https://mobx.js.org/faq/blogs.html)

### 2017å¹´02æœˆ26æ—¥ æ˜ŸæœŸæ—¥ åˆæ­¥æ•´åˆkityminder å­¦ä¹ mobx

![](/img/mmnote-add-kityminder.png)

çœ‹å®Œäº†mobxæ•™ç¨‹ï¼Œç‰›é€¼ï¼Œè¿™æ ·å°±å®ç°äº†è‡ªåŠ¨æ›´æ–°äº†ï¼Œå†™èµ·æ¥ç»å¯¹æ¯”reduxè¿™ç§è½»æ¾å¾ˆå¤šã€‚è‡³äºçŠ¶æ€æ˜¯å¯å˜çš„ï¼Œç›®å‰çœ‹æ¥åªæ˜¯ä¸èƒ½æ—¶é—´æ—…è¡Œäº†ã€‚

å¤§è‡´ç”¨äº†ä¸€ä¸‹ï¼Œçˆ½ï¼æœ€çˆ½çš„ä¸€ç‚¹æ˜¯å¯ä»¥ç›´æ¥èŒƒå›´å¯¹è±¡å±æ€§äº†ï¼Œè€Œä¸æ˜¯ä½¿ç”¨immutableå“ªç§æ¶å¿ƒçš„è®¿é—®æ–¹å¼ã€‚è¿™å°±å¯ä»¥ç”¨ä¸Štypescriptçš„ç±»å‹ä¼˜åŠ¿äº†ã€‚

# TODO 
- [ReactåŠ¨ç”»å®è·µ](http://www.alloyteam.com/2016/01/react-animation-practice/)
- source-map-support